<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Battle - Red vs Blue</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'neon-red': '#ff3366',
                        'neon-blue': '#00f2ff',
                        'game-bg': '#0f172a',
                        'tile-empty': '#334155',
                        'tile-correct': '#22c55e',
                        'tile-present': '#eab308',
                        'tile-absent': '#94a3b8'
                    },
                    animation: {
                        'pop': 'pop 0.3s ease-in-out',
                        'flip': 'flip 0.6s ease-in-out',
                        'shake': 'shake 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.5s ease-out forwards'
                    },
                    keyframes: {
                        pop: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '40%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' }
                        },
                        flip: {
                            '0%': { transform: 'rotateX(0deg)' },
                            '50%': { transform: 'rotateX(90deg)' },
                            '100%': { transform: 'rotateX(0deg)' }
                        },
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-5px)' },
                            '20%, 40%, 60%, 80%': { transform: 'translateX(5px)' }
                        },
                        slideIn: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)', maxHeight: '0px', marginBottom: '0px' },
                            '100%': { opacity: '1', transform: 'translateY(0)', maxHeight: '100px', marginBottom: '0.5rem' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; }
        .font-gaming { family: 'Black Ops One', cursive; }
        .tile { transition: background-color 0.3s, border-color 0.3s, color 0.3s, transform 0.6s; }
        .flip { animation: flip 0.6s ease-in-out forwards; }

        /* Hide scrollbar for standard browsers */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="h-screen flex flex-col text-white overflow-hidden bg-game-bg">

    <!-- HEADER: SCORES & STATUS -->
    <header class="p-4 flex justify-between items-start bg-slate-900/80 border-b border-slate-800 shadow-lg z-10">
        <!-- Red Score Area -->
        <div class="flex flex-col items-center w-1/4">
            <h2 class="text-neon-red font-gaming text-3xl md:text-4xl drop-shadow-[0_0_15px_rgba(255,51,102,0.8)] tracking-wider">RED TEAM</h2>
            <span id="score-red" class="text-5xl font-bold mt-1 drop-shadow-lg">0</span>
        </div>

        <!-- Center Status & Battle Bar -->
        <div class="flex flex-col items-center text-center w-2/4">
            <h1 class="text-3xl md:text-5xl font-gaming tracking-widest bg-clip-text text-transparent bg-gradient-to-r from-neon-red via-white to-neon-blue filter drop-shadow-[0_0_10px_rgba(255,255,255,0.3)] mb-3">
                WORD BATTLE
            </h1>
            
            <!-- BATTLE BAR -->
            <div class="w-full max-w-lg h-8 bg-slate-800 rounded-full overflow-hidden flex border-2 border-slate-700 shadow-[0_0_20px_rgba(0,0,0,0.5)] relative">
                <!-- Red part -->
                <div id="bar-red" class="h-full bg-gradient-to-r from-red-900 via-neon-red to-neon-red transition-all duration-700 ease-in-out flex items-center justify-end pr-2" style="width: 50%">
                     <div class="h-full w-full absolute top-0 left-0 bg-[linear-gradient(45deg,transparent_25%,rgba(255,255,255,0.1)_50%,transparent_75%,transparent_100%)] bg-[length:20px_20px] opacity-50"></div>
                </div>
                <!-- Blue part -->
                <div id="bar-blue" class="h-full bg-gradient-to-l from-blue-900 via-neon-blue to-neon-blue transition-all duration-700 ease-in-out flex items-center justify-start pl-2" style="width: 50%">
                    <div class="h-full w-full absolute top-0 left-0 bg-[linear-gradient(45deg,transparent_25%,rgba(255,255,255,0.1)_50%,transparent_75%,transparent_100%)] bg-[length:20px_20px] opacity-50"></div>
                </div>
                <!-- Center Marker -->
                <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-white z-10 -translate-x-1/2 shadow-[0_0_10px_white] mix-blend-overlay"></div>
                <!-- VS Icon -->
                 <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-slate-900 border-2 border-slate-600 rounded-full w-8 h-8 flex items-center justify-center text-xs font-gaming text-slate-300 z-20 shadow-lg">
                    VS
                </div>
            </div>

            <div id="round-timer" class="text-lg text-slate-400 mt-3 font-medium">Waiting for players...</div>
            <div id="connection-status" class="text-xs px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-300 mt-2 flex items-center animate-pulse">
                <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
                Connecting to TikFinity...
            </div>
        </div>

        <!-- Blue Score Area -->
        <div class="flex flex-col items-center w-1/4">
            <h2 class="text-neon-blue font-gaming text-3xl md:text-4xl drop-shadow-[0_0_15px_rgba(0,242,255,0.8)] tracking-wider">BLUE TEAM</h2>
            <span id="score-blue" class="text-5xl font-bold mt-1 drop-shadow-lg">0</span>
        </div>
    </header>

    <!-- MAIN GAME AREA -->
    <main class="flex-1 flex p-4 gap-4 md:gap-8 justify-center items-start overflow-hidden">
        
        <!-- RED BOARD CONTAINER -->
        <div class="flex-1 max-w-md flex flex-col items-center h-full">
            <div class="w-full p-2 md:p-3 bg-gradient-to-b from-red-950/50 to-transparent border-t-2 border-neon-red/50 rounded-xl mb-4 text-center flex-shrink-0">
                <h3 class="text-neon-red font-bold text-sm md:text-base mb-1 opacity-80">LATEST ATTACK BY:</h3>
                <div id="last-user-red" class="h-8 text-base md:text-lg text-white font-semibold truncate animate-pop drop-shadow-md">-</div>
            </div>
            <!-- The Grid (Scrollable, No Scrollbar) -->
            <div id="board-red" class="w-full flex-1 overflow-y-auto no-scrollbar p-3 md:p-4 bg-slate-900/80 rounded-2xl border-2 border-red-900/50 shadow-[0_0_40px_rgba(255,51,102,0.1)] backdrop-blur-sm flex flex-col">
                <!-- Tiles generated by JS will be PREPENDED here -->
            </div>
        </div>

        <!-- BLUE BOARD CONTAINER -->
        <div class="flex-1 max-w-md flex flex-col items-center h-full">
            <div class="w-full p-2 md:p-3 bg-gradient-to-b from-blue-950/50 to-transparent border-t-2 border-neon-blue/50 rounded-xl mb-4 text-center flex-shrink-0">
                <h3 class="text-neon-blue font-bold text-sm md:text-base mb-1 opacity-80">LATEST ATTACK BY:</h3>
                <div id="last-user-blue" class="h-8 text-base md:text-lg text-white font-semibold truncate animate-pop drop-shadow-md">-</div>
            </div>
            <!-- The Grid (Scrollable, No Scrollbar) -->
            <div id="board-blue" class="w-full flex-1 overflow-y-auto no-scrollbar p-3 md:p-4 bg-slate-900/80 rounded-2xl border-2 border-blue-900/50 shadow-[0_0_40px_rgba(0,242,255,0.1)] backdrop-blur-sm flex flex-col">
                <!-- Tiles generated by JS will be PREPENDED here -->
            </div>
        </div>

    </main>

    <!-- FOOTER / MANUAL INPUT FOR TESTING -->
    <footer class="p-3 bg-slate-950/90 backdrop-blur text-slate-400 text-sm flex justify-between items-center border-t border-slate-900 z-10">
        <div class="font-semibold">
            Total Recruits: <span id="player-count" class="text-white text-base ml-1">0</span> 
            <span class="ml-3">( <span class="text-neon-red">R: <span id="count-red">0</span></span> | 
             <span class="text-neon-blue">B: <span id="count-blue">0</span></span> )</span>
        </div>
        <!-- Manual Testing Input -->
        <div class="flex gap-2 items-center bg-slate-900 p-1.5 rounded-lg border border-slate-800/50">
            <span class="text-[10px] uppercase font-bold tracking-wider opacity-50 hidden md:block">Admin Console:</span>
            <input type="text" id="manual-guess" placeholder="5-LETTER WORD" maxlength="5" class="bg-slate-800 text-white px-3 py-1 rounded-md uppercase w-36 text-sm font-bold tracking-widest focus:outline-none focus:ring-2 focus:ring-white/20 border border-slate-700">
            <button onclick="manualSubmit('red')" class="bg-gradient-to-br from-red-600 to-red-800 hover:from-neon-red hover:to-red-600 text-white px-4 py-1 rounded-md text-xs font-bold transition-all shadow-lg shadow-red-900/50 active:scale-95">RED</button>
            <button onclick="manualSubmit('blue')" class="bg-gradient-to-br from-blue-600 to-blue-800 hover:from-neon-blue hover:to-blue-600 text-white px-4 py-1 rounded-md text-xs font-bold transition-all shadow-lg shadow-blue-900/50 active:scale-95">BLUE</button>
        </div>
    </footer>

    <!-- WINNER OVERLAY -->
    <div id="winner-overlay" class="fixed inset-0 bg-slate-950/95 backdrop-blur-md z-50 hidden flex flex-col items-center justify-center">
        <h2 id="winner-text" class="font-gaming text-7xl md:text-9xl mb-8 animate-pop drop-shadow-[0_0_50px_rgba(255,255,255,0.3)]">RED WINS!</h2>
        <div class="flex flex-col items-center bg-slate-900/50 p-8 rounded-2xl border border-white/10">
            <div class="text-3xl text-slate-400 mb-2 uppercase tracking-widest">The word was</div>
            <div id="revealed-word" class="font-gaming text-6xl text-white tracking-[0.2em] drop-shadow-lg mb-6">HELLO</div>
            <div class="text-2xl text-white flex items-center bg-slate-800/80 px-6 py-3 rounded-full">
                Next battle in <span id="countdown" class="font-gaming text-neon-yellow text-4xl mx-3 w-12 text-center">5</span>s
            </div>
        </div>
    </div>

    <script>
        // --- GAME CONFIG & STATE ---
        const WORD_LENGTH = 5;
        // REMOVED MAX_GUESSES limit for infinite scrolling battle feel.
        // Can add it back if you want a strictly limited round.
        const MAX_GUESSES = 999; 
        const WORD_LIST = ["REACT", "APPLE", "TRAIN", "HOUSE", "PIZZA", "RIVER", "GHOST", "BASIC", "OUTER", "NEVER", "WORLD", "HELLO", "VIDEO", "LIGHT", "SOUND", "WATER", "START", "FORCE", "POWER", "NIGHT", "LAUGH", "TIGER", "EARTH", "SPACE", "BRAIN", "SMILE", "BEACH", "DREAM", "FOCUS", "GAMER", "TWITCH", "TIKTOK", "SUPER", "ULTRA", "FIGHT", "MAGIC", "NINJA", "ROBOT", "ALIEN", "LEVEL", "SHARK", "EAGLE", "LION", "WOLF", "BEAR", "SNAKE", "COBRA", "VIPER", "FLASH", "STORM", "BLAZE", "FROST", "SHADE", "STEEL", "IRON", "METAL", "SWORD", "ARROW", "ARMOR", "SHIELD"];
        
        let state = {
            targetWord: "",
            redGuesses: [],
            blueGuesses: [],
            redScore: 0,
            blueScore: 0,
            isRoundActive: false,
            users: {} 
        };

        // --- DOM REFERENCES ---
        const els = {
            boardRed: document.getElementById('board-red'),
            boardBlue: document.getElementById('board-blue'),
            scoreRed: document.getElementById('score-red'),
            scoreBlue: document.getElementById('score-blue'),
            lastUserRed: document.getElementById('last-user-red'),
            lastUserBlue: document.getElementById('last-user-blue'),
            status: document.getElementById('connection-status'),
            roundTimer: document.getElementById('round-timer'),
            winnerOverlay: document.getElementById('winner-overlay'),
            winnerText: document.getElementById('winner-text'),
            revealedWord: document.getElementById('revealed-word'),
            countdown: document.getElementById('countdown'),
            playerCount: document.getElementById('player-count'),
            countRed: document.getElementById('count-red'),
            countBlue: document.getElementById('count-blue'),
            barRed: document.getElementById('bar-red'),
            barBlue: document.getElementById('bar-blue'),
        };

        // --- INITIALIZATION ---
        function initBoards() {
            // Clear boards for new round
            els.boardRed.innerHTML = '';
            els.boardBlue.innerHTML = '';
        }

        function startNewRound() {
            state.isRoundActive = true;
            state.targetWord = WORD_LIST[Math.floor(Math.random() * WORD_LIST.length)];
            state.redGuesses = [];
            state.blueGuesses = [];
            
            initBoards();
            els.lastUserRed.textContent = '-';
            els.lastUserBlue.textContent = '-';
            els.winnerOverlay.classList.add('hidden');
            els.roundTimer.textContent = "ROUND ACTIVE! DEPLOY YOUR WORDS!";
            
            console.log("Target:", state.targetWord); 
        }

        function updateBattleBar() {
            const total = state.redScore + state.blueScore;
            let redPercent = 50;
            let bluePercent = 50;

            if (total > 0) {
                redPercent = (state.redScore / total) * 100;
                bluePercent = 100 - redPercent;
            }
            
            if (state.redScore > 0 && redPercent < 5) redPercent = 5;
            if (state.blueScore > 0 && bluePercent < 5) bluePercent = 5;
             if (total > 0) {
                 bluePercent = 100 - redPercent;
             }

            els.barRed.style.width = `${redPercent}%`;
            els.barBlue.style.width = `${bluePercent}%`;
        }

        // --- TEAM LOGIC ---
        function assignTeam(userId, nickname) {
            if (state.users[userId]) return state.users[userId].team;
            let redCount = 0, blueCount = 0;
            Object.values(state.users).forEach(u => u.team === 'red' ? redCount++ : blueCount++);
            const newTeam = (redCount <= blueCount) ? 'red' : 'blue';
            state.users[userId] = { team: newTeam, name: nickname };
            updatePlayerCounts();
            return newTeam;
        }

        function updatePlayerCounts() {
             let redCount = 0, blueCount = 0;
             Object.values(state.users).forEach(u => u.team === 'red' ? redCount++ : blueCount++);
             els.playerCount.textContent = redCount + blueCount;
             els.countRed.textContent = redCount;
             els.countBlue.textContent = blueCount;
        }

        // --- GAMEPLAY LOGIC ---
        function processGuess(team, word, nickname) {
            if (!state.isRoundActive) return;
            if (word.length !== 5) return;

            const guesses = team === 'red' ? state.redGuesses : state.blueGuesses;
            // Optional: Limit total guesses if desired, currently effectively unlimited for battle
            // if (guesses.length >= MAX_GUESSES) return; 

            guesses.push(word);
            const userEl = team === 'red' ? els.lastUserRed : els.lastUserBlue;
            userEl.textContent = nickname;
            userEl.classList.remove('animate-pop');
            void userEl.offsetWidth; 
            userEl.classList.add('animate-pop');

            // RENDER AND PREPEND
            createAndPrependRow(team === 'red' ? els.boardRed : els.boardBlue, word);

            if (word === state.targetWord) {
                endRound(team);
            }
            // Draw condition removed for infinite battle until win
        }

        function createAndPrependRow(boardEl, guess) {
            const row = document.createElement('div');
            // Added 'animate-slide-in' and 'mb-2' for spacing between rows
            row.className = 'grid grid-cols-5 gap-2 mb-2 animate-slide-in flex-shrink-0';
            
            const target = state.targetWord;
            let letterCounts = {};
            for (let char of target) letterCounts[char] = (letterCounts[char] || 0) + 1;

            let status = new Array(5).fill('absent');
            for (let i = 0; i < 5; i++) {
                if (guess[i] === target[i]) {
                    status[i] = 'correct';
                    letterCounts[guess[i]]--;
                }
            }
            for (let i = 0; i < 5; i++) {
                if (status[i] !== 'correct' && target.includes(guess[i]) && letterCounts[guess[i]] > 0) {
                    status[i] = 'present';
                    letterCounts[guess[i]]--;
                }
            }

            // Create tiles
            for (let i = 0; i < 5; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile w-10 h-10 md:w-14 md:h-14 border-2 border-slate-700 flex items-center justify-center text-xl md:text-3xl font-bold uppercase bg-slate-800/80 rounded-md md:rounded-lg';
                tile.textContent = guess[i];
                row.appendChild(tile);

                // Trigger flip & color after a short delay so they slide in first, then flip
                setTimeout(() => {
                    tile.classList.add('flip');
                    setTimeout(() => {
                        if (status[i] === 'correct') tile.classList.add('bg-tile-correct', 'border-tile-correct', 'shadow-[0_0_15px_rgba(34,197,94,0.5)]');
                        else if (status[i] === 'present') tile.classList.add('bg-tile-present', 'border-tile-present');
                        else tile.classList.add('bg-tile-absent', 'border-tile-absent', 'opacity-50');
                        tile.classList.remove('bg-slate-800/80', 'border-slate-700');
                    }, 300);
                }, 100 + (i * 150)); // Slightly delayed start to let slide-in happen
            }

            // PREPEND to show newest at top
            boardEl.prepend(row);
        }

        function endRound(winner) {
            state.isRoundActive = false;
            if (winner === 'red') {
                state.redScore++;
                els.scoreRed.textContent = state.redScore;
                els.winnerText.textContent = "RED TEAM WINS!";
                els.winnerText.className = "font-gaming text-7xl md:text-9xl mb-8 animate-pop drop-shadow-[0_0_50px_rgba(255,51,102,0.8)] text-neon-red";
            } else if (winner === 'blue') {
                state.blueScore++;
                els.scoreBlue.textContent = state.blueScore;
                els.winnerText.textContent = "BLUE TEAM WINS!";
                els.winnerText.className = "font-gaming text-7xl md:text-9xl mb-8 animate-pop drop-shadow-[0_0_50px_rgba(0,242,255,0.8)] text-neon-blue";
            } else {
                // Draw less likely now with infinite guesses, but kept just in case
                els.winnerText.textContent = "STALEMATE!";
                els.winnerText.className = "font-gaming text-7xl md:text-9xl mb-8 animate-pop drop-shadow-2xl text-slate-300";
            }
            
            updateBattleBar(); 

            els.revealedWord.textContent = state.targetWord;
            els.winnerOverlay.classList.remove('hidden');

            let count = 5;
            els.countdown.textContent = count;
            const timer = setInterval(() => {
                count--;
                els.countdown.textContent = count;
                if (count <= 0) {
                    clearInterval(timer);
                    startNewRound();
                }
            }, 1000);
        }

        // --- TIKFINITY & WS ---
        let ws;
        function connectTikFinity() {
            els.status.innerHTML = '<span class="w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-ping"></span>Connecting...';
            els.status.className = "text-xs px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-300 mt-2 flex items-center";
            try {
                ws = new WebSocket('ws://localhost:21213/');
                ws.onopen = () => {
                    els.status.innerHTML = '<span class="w-2 h-2 bg-green-500 rounded-full mr-2 shadow-[0_0_10px_#22c55e]"></span>LIVE CONNECTED';
                    els.status.className = "text-xs px-3 py-1 rounded-full bg-green-500/20 text-green-400 mt-2 flex items-center font-bold tracking-wider";
                    console.log("TikFinity Connected");
                };
                ws.onclose = () => {
                    els.status.innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>DISCONNECTED';
                    els.status.className = "text-xs px-3 py-1 rounded-full bg-red-500/20 text-red-400 mt-2 flex items-center font-bold";
                    setTimeout(connectTikFinity, 5000);
                };
                ws.onerror = (err) => { ws.close(); };
                ws.onmessage = (event) => {
                    try {
                        const pl = JSON.parse(event.data);
                        if (pl.event === 'chat') handleChat(pl.data);
                    } catch (e) {}
                };
            } catch (e) { setTimeout(connectTikFinity, 5000); }
        }

        function handleChat(data) {
            const comment = (data.comment || "").trim().toUpperCase();
            if (!comment || comment.length !== 5 || !/^[A-Z]+$/.test(comment)) return;
            processGuess(assignTeam(data.uniqueId, data.nickname || data.uniqueId), comment, data.nickname || data.uniqueId);
        }

        function manualSubmit(team) {
            const val = document.getElementById('manual-guess').value.trim().toUpperCase();
            if (val.length === 5) {
                processGuess(team, val, "ADMIN");
                document.getElementById('manual-guess').value = "";
            }
        }

        initBoards();
        startNewRound();
        connectTikFinity();
    </script>
</body>
</html>